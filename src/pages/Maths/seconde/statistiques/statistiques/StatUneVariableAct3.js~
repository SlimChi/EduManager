import React, {useRef, useState} from 'react';
import {FaChartBar, FaPrint, FaCheck, FaCalculator, FaDice} from 'react-icons/fa';
import {BsFillQuestionCircleFill} from 'react-icons/bs';
import {IoMdSchool} from 'react-icons/io';
import '../../../../../styles/activites.css';
import {useLocation, useParams} from "react-router-dom";
import diagrammeImage from '../../../../../assets/histo.png';
import BackButton from "../../../../../components/navigation/BackButton";
import PrintManager from "../../../../../utils/PrintManager";
import Automatismes from "../../../../../config/Automatismes";
import {FcBullish} from "react-icons/fc";
import stat1act3 from "../../../../../assets/shrek.jpg";
import ModalImage from "../../../../../utils/ModalImage";
import Automatismes2 from "../../../../../config/Automatismes2";

const StatUneVariableAct3 = () => {
    const {classId} = useParams();
    const location = useLocation();
    const className = location.state?.className || '';

    const [answers, setAnswers] = useState({
        question2: '',
        question3a: '',
        question3b: '',
        question3c: '',
        question5: ''
    });

    const [effectifs, setEffectifs] = useState({
        classe0_2: 0,
        classe2_4: 0,
        classe4_6: 0,
        classe6_8: 0
    });

    const [showCorrections, setShowCorrections] = useState({
        question2: false,
        question3a: false,
        question3b: false,
        question3c: false,
        question5: false
    });

    // R√©ponses attendues
    const correctAnswers = {
        question2: "La population √©tudi√©e est les √©l√®ves interrog√©s par l'enqu√™teur.",
        question3a: "Le caract√®re √©tudi√© est la dur√©e d'utilisation du t√©l√©phone portable.",
        question3b: "Le caract√®re est quantitatif car il peut √™tre mesur√© num√©riquement (en heures et minutes).",
        question3c: "Le caract√®re est continu car la dur√©e peut prendre n'importe quelle valeur dans un intervalle.",
        question5: "Un histogramme est le plus adapt√© pour cette s√©rie statistique car les donn√©es sont regroup√©es en classes."
    };

    const [modalState, setModalState] = useState({
        show: false,
        imageUrl: '',
        altText: ''
    });

    const openModal = (imageUrl, altText) => {
        setModalState({show: true, imageUrl, altText});
    };

    const closeModal = () => {
        setModalState(prev => ({...prev, show: false}));
    };

    const handleInputChange = (field, value) => {
        setAnswers(prev => ({
            ...prev,
            [field]: value
        }));
    };

    const handleEffectifChange = (classe, value) => {
        setEffectifs(prev => ({
            ...prev,
            [classe]: parseInt(value) || 0
        }));
    };

    const contentRef = useRef();

    const toggleCorrection = (field) => {
        setShowCorrections(prev => ({
            ...prev,
            [field]: !prev[field]
        }));

        if (!answers[field] && !showCorrections[field]) {
            setAnswers(prev => ({
                ...prev,
                [field]: correctAnswers[field]
            }));
        }
    };

    if (className === 'Secondeastat-une-variableact3') {
        return <div>Cette activit√© n'est pas disponible pour cette classe.</div>;
    }

    return (
        <>
            <BackButton/>
            <div className="tp-container" id="stat-act3-content" ref={contentRef}>
                <PrintManager
                    contentRef={contentRef}
                    activityName="Statistiques_Duree_Telephone_Act3"
                    pageCount={2}
                    quality="hd"
                />

                {/* PAGE 1 */}
                <div className="print-page">
                    <div style={{marginTop: '-10px'}}>
                        <Automatismes2/>
                    </div>
                    <div className="activity-header mt-0">
                        <span className="activity-badge">ACTIVIT√â 3</span>
                        <div className="activity-title">
                            <span className="course-title">
                                <FaDice/> <FcBullish/> ¬´ Dur√©e d'utilisation du t√©l√©phone portable ¬ª
                            </span>
                        </div>
                    </div>

                    <div className="d-flex align-items-start flex-wrap" style={{gap: '20px'}}>
                        <div style={{flex: 1, minWidth: '300px'}}>
                            <div className="renovation-contexte">
                                <h5 className="mb-3 text-primary fw-bold">
                                    üìä "Analyse de la dur√©e d'utilisation du t√©l√©phone portable"
                                </h5>

                                <p style={{textAlign: 'justify', fontSize: '15px', lineHeight: '1.3'}}>
                                    Pour mieux comprendre les habitudes des √©l√®ves, un professeur m√®ne une petite
                                    enqu√™te.
                                    Il demande √† chaque √©l√®ve combien de temps il a utilis√© son t√©l√©phone portable la
                                    veille, en heures et minutes.
                                </p>

                                <div className="objectif-box" style={{marginTop: '10px', padding: '10px'}}>
                                    <div className="objectif-title"><strong style={{color: 'orangered'}}>Objectif
                                        :</strong> üéØ Comprendre comment recueillir, organiser et repr√©senter des
                                        donn√©es √† partir d'une enqu√™te sur l'utilisation du t√©l√©phone.
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* PHOTO - DISPOSITION CONSERV√âE */}
                        <div className="flex-shrink-0"
                             style={{maxWidth: '250px', cursor: 'pointer', marginTop: '10px'}}>
                            <img src={stat1act3}
                                 alt="Utilisation du t√©l√©phone portable"
                                 className="img-fluid rounded shadow-sm compact-img"
                                 onClick={() => openModal(stat1act3, "Utilisation du t√©l√©phone portable")}
                            />
                        </div>
                    </div>

                    {/* Section S'approprier */}
                    <div className="question-card mt-1 mb-0">
                        <div className="question-content">
                            <h4 className="vect-title"
                                style={{display: 'inline', marginRight: '10px', marginTop: '0'}}>
                                <span>S'approprier</span>
                            </h4>
                            <p style={{display: 'inline', textAlign: 'justify'}}>
                                Les r√©sultats obtenus :
                            </p>

                            <div className="data-grid mt-3 mb-3">
                                {['2h30', '3h15', '1h45', '5h00', '4h30', '2h15', '6h00',
                                    '3h30', '7h00', '2h45', '5h15', '3h00', '4h00', '2h00',
                                    '6h30'].map((val, i) => (
                                    <span key={i} className="data-cell">{val}</span>
                                ))}
                            </div>

                            {/* Question 2 */}
                            <div className="question-item" style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '10px',
                                flexWrap: 'wrap',
                                marginBottom: '5px'
                            }}>
                                <p style={{margin: '0', flex: '1'}}>
                                    2) Quelle est la population √©tudi√©e lors de cette enqu√™te ?
                                    <span
                                        className="answer-dots"> .................................................................................</span>
                                </p>
                                <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                    <button
                                        className="correction-btnoptic"
                                        onClick={() => toggleCorrection('question2')}
                                        style={{padding: '2px 6px', fontSize: '12px'}}
                                    >
                                        <FaCheck/> {showCorrections.question2 ? '‚úï' : '‚úì'}
                                    </button>
                                </div>
                            </div>

                            {/* Question 3a */}
                            <div className="question-item" style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '5px',
                                flexWrap: 'wrap',
                                marginBottom: '5px'
                            }}>
                                <p style={{margin: '0', flex: '1'}}>
                                    3) a) Quel est le caract√®re √©tudi√© dans cette enqu√™te statistique ?
                                    <span
                                        className="answer-dots"> .................................................................................</span>
                                </p>
                                <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                    <button
                                        className="correction-btnoptic"
                                        onClick={() => toggleCorrection('question3a')}
                                        style={{padding: '2px 6px', fontSize: '12px'}}
                                    >
                                        <FaCheck/> {showCorrections.question3a ? '‚úï' : '‚úì'}
                                    </button>
                                </div>
                            </div>

                            {/* Question 3b */}
                            <div className="question-item" style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '5px',
                                flexWrap: 'wrap',
                                marginBottom: '5px'
                            }}>
                                <p style={{margin: '0', flex: '1'}}>
                                    b) Ce caract√®re est-il quantitatif ou qualitatif ? Justifiez.
                                    <span
                                        className="answer-dots"> .................................................................................</span>
                                </p>
                                <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                    <button
                                        className="correction-btnoptic"
                                        onClick={() => toggleCorrection('question3b')}
                                        style={{padding: '2px 6px', fontSize: '12px'}}
                                    >
                                        <FaCheck/> {showCorrections.question3b ? '‚úï' : '‚úì'}
                                    </button>
                                </div>
                            </div>

                            {/* Question 3c */}
                            <div className="question-item" style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '10px',
                                flexWrap: 'wrap',
                                marginBottom: '5px'
                            }}>
                                <p style={{margin: '0', flex: '1'}}>
                                    c) Ce caract√®re est-il discret ou continu ? Justifiez.
                                    <span
                                        className="answer-dots"> .................................................................................</span>
                                </p>
                                <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                    <button
                                        className="correction-btnoptic"
                                        onClick={() => toggleCorrection('question3c')}
                                        style={{padding: '2px 6px', fontSize: '12px'}}
                                    >
                                        <FaCheck/> {showCorrections.question3c ? '‚úï' : '‚úì'}
                                    </button>
                                </div>
                            </div>

                            {/* Affichage des corrections */}
                            {showCorrections.question2 && (
                                <div className="correction-box" style={{
                                    backgroundColor: '#e8f5e9',
                                    padding: '8px',
                                    borderRadius: '4px',
                                    margin: '5px 0'
                                }}>
                                    <strong>Correction :</strong> {correctAnswers.question2}
                                </div>
                            )}
                            {showCorrections.question3a && (
                                <div className="correction-box" style={{
                                    backgroundColor: '#e8f5e9',
                                    padding: '8px',
                                    borderRadius: '4px',
                                    margin: '5px 0'
                                }}>
                                    <strong>Correction :</strong> {correctAnswers.question3a}
                                </div>
                            )}
                            {showCorrections.question3b && (
                                <div className="correction-box" style={{
                                    backgroundColor: '#e8f5e9',
                                    padding: '8px',
                                    borderRadius: '4px',
                                    margin: '5px 0'
                                }}>
                                    <strong>Correction :</strong> {correctAnswers.question3b}
                                </div>
                            )}
                            {showCorrections.question3c && (
                                <div className="correction-box" style={{
                                    backgroundColor: '#e8f5e9',
                                    padding: '8px',
                                    borderRadius: '4px',
                                    margin: '5px 0'
                                }}>
                                    <strong>Correction :</strong> {correctAnswers.question3c}
                                </div>
                            )}
                        </div>

                        <div className="question-content">
                            <h4 className="vect-title" style={{display: 'inline', marginRight: '10px'}}>
                                <span>R√©aliser</span>
                            </h4>
                            <p style={{display: 'inline', textAlign: 'justify'}}>
                                4) Pour que les r√©sultats soient plus lisibles, on peut les regrouper par classes dans
                                un tableau d'effectifs.
                            </p>

                            <div className="table-responsive" style={{flex: '1', minWidth: '220px'}}>
                                <table className="table table-bordered text-center shadow-sm"
                                       style={{fontSize: '14px'}}>
                                    <thead className="table-light">
                                    <tr>
                                        <th>Dur√©e (heures)</th>
                                        <th>]0 ; 2]</th>
                                        <th>]2 ; 4]</th>
                                        <th>]4 ; 6]</th>
                                        <th>]6 ; 8]</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>Effectif</td>
                                        <td>
                                            ..........
                                        </td>
                                        <td>
                                            ..........
                                        </td>
                                        <td>
                                            ..........
                                        </td>
                                        <td>
                                            ..........
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Section Communiquer */}

                        <div className="question-content mt-0">
                            <h4 className="vect-title" style={{display: 'inline', marginRight: '10px'}}>
                                <span>Communiquer</span>
                            </h4>
                            <p style={{display: 'inline', textAlign: 'justify'}}>
                                5) Quel type de diagramme est le plus adapt√© pour repr√©senter cette s√©rie
                                statistique ? <span
                                className="answer-dots"> ..........................................................................................</span>
                            </p>


                            {/* Question 5 */}
                            <div className="question-item" style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '10px',
                                flexWrap: 'wrap',
                                marginBottom: '15px'
                            }}>
                                <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                    <button
                                        className="correction-btnoptic"
                                        onClick={() => toggleCorrection('question5')}
                                        style={{padding: '2px 6px', fontSize: '12px'}}
                                    >
                                        <FaCheck/> {showCorrections.question5 ? '‚úï' : '‚úì'}
                                    </button>
                                </div>
                            </div>

                            {showCorrections.question5 && (
                                <div className="correction-box" style={{
                                    backgroundColor: 'rgba(232, 245, 233, 0.9)',
                                    padding: '8px',
                                    borderRadius: '4px',
                                    margin: '5px 0',
                                    backdropFilter: 'blur(2px)'
                                }}>
                                    <strong>Correction :</strong> {correctAnswers.question5}
                                </div>
                            )}

                            <p>6) √Ä l'aide du tableau, compl√©tez l'histogramme ci-dessous.</p>

                            {/* PHOTO - DISPOSITION CONSERV√âE */}
                            <div className="diagram-placeholder" style={{
                                height: 'auto',
                                margin: '10px 0',
                                display: 'flex',
                                justifyContent: 'center',
                                alignItems: 'center',
                                backgroundColor: '#ffffff',
                                padding: '10px',
                                borderRadius: '12px'
                            }}>
                                <img src={diagrammeImage} alt="Histogramme" style={{
                                    maxWidth: '57%',
                                    height: 'auto',
                                    border: '2px solid #ccc',
                                    borderRadius: '8px'
                                }}/>
                            </div>

                        </div>
                    </div>
                </div>

                {modalState.show && (
                    <ModalImage
                        imageUrl={modalState.imageUrl}
                        altText={modalState.altText}
                        onClose={closeModal}
                    />
                )}
            </div>
        </>
    );
};

export default StatUneVariableAct3;